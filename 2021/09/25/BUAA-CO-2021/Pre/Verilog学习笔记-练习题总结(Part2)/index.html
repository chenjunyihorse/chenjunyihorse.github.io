<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="FlyingLandlord's Blog" href="http://flyinglandlord.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="FlyingLandlord's Blog" href="http://flyinglandlord.github.io/atom.xml"><link rel="alternate" type="application/json" title="FlyingLandlord's Blog" href="http://flyinglandlord.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="北航计算机组成原理,Verilog,Pre课下"><link rel="canonical" href="http://flyinglandlord.github.io/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part2)/"><title>Verilog 学习笔记（2） - 北航计算机组成原理 | Test Blog = FlyingLandlord's Blog</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Verilog 学习笔记（2）</h1><div class="meta"><span class="item" title="创建时间：2021-09-25 18:45:45"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-09-25T18:45:45+08:00">2021-09-25</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Test Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?341053"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?378537"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?296696"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?675682"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?153564"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?529177"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" itemprop="item" rel="index" title="分类于 北航计算机组成原理"><span itemprop="name">北航计算机组成原理</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://flyinglandlord.github.io/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part2)/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="FL"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="FlyingLandlord's Blog"></span><div class="body md" itemprop="articleBody"><h1 id="verilog-学习笔记-练习题总结part-2"><a class="anchor" href="#verilog-学习笔记-练习题总结part-2">#</a> Verilog 学习笔记 - 练习题总结（Part 2）</h1><h2 id="有限状态机fsm"><a class="anchor" href="#有限状态机fsm">#</a> 有限状态机 (FSM)</h2><p>用三组例题进行讲解</p><h3 id="题组一lemmings游戏"><a class="anchor" href="#题组一lemmings游戏">#</a> 题组一：Lemmings 游戏</h3><h3 id="题目来源hdlbits-examsece241_2013_q4"><a class="anchor" href="#题目来源hdlbits-examsece241_2013_q4">#</a> <em>题目来源：hdlbits, exams/ece241_2013_q4</em></h3><h4 id="easy-lemmings-1"><a class="anchor" href="#easy-lemmings-1">#</a> Easy: Lemmings 1</h4><p><a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/File:Lemmings.gif"><img data-src="https://hdlbits.01xz.net/mw/images/d/de/Lemmings.gif" alt="Lemmings.gif"></a></p><p>The game <span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGVtbWluZ3NfKHZpZGVvX2dhbWUp">Lemmings</span> involves critters with fairly simple brains. So simple that we are going to model it using a finite state machine.</p><p>In the Lemmings' 2D world, Lemmings can be in one of two states: walking left or walking right. It will switch directions if it hits an obstacle. In particular, if a Lemming is bumped on the left, it will walk right. If it's bumped on the right, it will walk left. If it's bumped on both sides at the same time, it will still switch directions.</p><p>Implement a Moore state machine with two states, two inputs, and one output that models this behaviour.</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> areset<span class="token punctuation">,</span>    <span class="token comment">// Freshly brainwashed Lemmings walk left.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> bump_left<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">input</span> bump_right<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">output</span> walk_left<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">output</span> walk_right<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  </span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">parameter</span> LEFT<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> RIGHT<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">reg</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            LEFT<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>bump_left <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> RIGHT <span class="token punctuation">:</span> LEFT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            RIGHT<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>bump_right <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> LEFT <span class="token punctuation">:</span> RIGHT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">,</span> <span class="token keyword">posedge</span> areset<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>areset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> LEFT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">else</span> state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">assign</span> walk_left <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">assign</span> walk_right <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> RIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><p>Easy 难度，按照题意模拟即可，只有两个状态 LEFT 和 RIGHT</p><h4 id="hard-lemmings-2"><a class="anchor" href="#hard-lemmings-2">#</a> Hard: Lemmings 2</h4><p><a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/File:Lemmings2.gif"><img data-src="https://hdlbits.01xz.net/mw/images/7/70/Lemmings2.gif" alt="Lemmings2.gif"></a></p><p>In addition to walking left and right, Lemmings will fall (and presumably go &quot;aaah!&quot;) if the ground disappears underneath them.</p><p>In addition to walking left and right and changing direction when bumped, when <code>ground=0</code> , the Lemming will fall and say &quot;aaah!&quot;. When the ground reappears ( <code>ground=1</code> ), the Lemming will resume walking in the same direction as before the fall. Being bumped while falling does not affect the walking direction, and being bumped in the same cycle as ground disappears (but not yet falling), or when the ground reappears while still falling, also does not affect the walking direction.</p><p>Build a finite state machine that models this behaviour.</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> areset<span class="token punctuation">,</span>    <span class="token comment">// Freshly brainwashed Lemmings walk left.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> bump_left<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">input</span> bump_right<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">input</span> ground<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">output</span> walk_left<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">output</span> walk_right<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">output</span> aaah <span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">parameter</span> L <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> R <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> FL <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> FR <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    </pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            L<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>bump_left <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            R<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>bump_right <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            FL<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                    <span class="token comment">/*if(bump_left == 1) next_state = R;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                    else next_state = L;*/</pre></td></tr><tr><td data-num="31"></td><td><pre>                    next_state <span class="token operator">=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token keyword">end</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> FL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            FR<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span> </pre></td></tr><tr><td data-num="37"></td><td><pre>                    <span class="token comment">/*if(bump_right == 1) next_state = L;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                    else next_state = R;*/</pre></td></tr><tr><td data-num="39"></td><td><pre>                    next_state <span class="token operator">=</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                <span class="token keyword">end</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> FR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    </pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">,</span> <span class="token keyword">posedge</span> areset<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>areset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token keyword">else</span> state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    </pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> FL <span class="token operator">||</span> state <span class="token operator">==</span> FR<span class="token punctuation">)</span> aaah <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">else</span> aaah <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        walk_left <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> L<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        walk_right <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    </pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><p>Hard 难度，考虑到题目要求下落的情况，需要增加两种状态，因为下落不改变原来的方向，同时需要<strong>注意下落优先级高于转身，所以下落过程中 <code>bump_left</code> 和 <code>bump_right</code> 都没有效果</strong></p><h4 id="expert-lemmings-3"><a class="anchor" href="#expert-lemmings-3">#</a> Expert: Lemmings 3</h4><p><a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/File:Lemmings3.gif"><img data-src="https://hdlbits.01xz.net/mw/images/a/a2/Lemmings3.gif" alt="Lemmings3.gif"></a></p><p>In addition to walking and falling, Lemmings can sometimes be told to do useful things, like dig (it starts digging when <code>dig=1</code> ). A Lemming can dig if it is currently walking on ground ( <code>ground=1</code> and not falling), and will continue digging until it reaches the other side ( <code>ground=0</code> ). At that point, since there is no ground, it will fall (aaah!), then continue walking in its original direction once it hits ground again. As with falling, being bumped while digging has no effect, and being told to dig when falling or when there is no ground is ignored.</p><p>(In other words, a walking Lemming can fall, dig, or switch directions. If more than one of these conditions are satisfied, fall has higher precedence than dig, which has higher precedence than switching directions.)</p><p>Extend your finite state machine to model this behaviour.</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> areset<span class="token punctuation">,</span>    <span class="token comment">// Freshly brainwashed Lemmings walk left.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> bump_left<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">input</span> bump_right<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">input</span> ground<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">input</span> dig<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">output</span> walk_left<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">output</span> walk_right<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">output</span> aaah<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">output</span> digging</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">parameter</span> L <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> R <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> FL <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> FR <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> DL <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> DR <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    </pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    </pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            L<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>dig <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> DL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>bump_left <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            R<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>dig <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> DR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>bump_right <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            FL<span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> FL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            FR<span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> FL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            DL<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> DL<span class="token punctuation">;</span>                </pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            DR<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> DR<span class="token punctuation">;</span>                </pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token keyword">default</span><span class="token punctuation">:</span> next_state <span class="token operator">=</span> state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    </pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">,</span> <span class="token keyword">posedge</span> areset<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>areset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token keyword">else</span> state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    </pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> FL <span class="token operator">||</span> state <span class="token operator">==</span> FR<span class="token punctuation">)</span> aaah <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">else</span> aaah <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        walk_left <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> L<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        walk_right <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        digging <span class="token operator">=</span> state <span class="token operator">==</span> DL <span class="token operator">||</span> state <span class="token operator">==</span> DR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    </pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><p>Expert 难度，考虑挖矿不会改变方向，但是可能会掉落，同时挖矿时 <code>bump_left</code> 和 <code>bump_right</code> 也都没有效果</p><h4 id="special-lemmings-4"><a class="anchor" href="#special-lemmings-4">#</a> Special: Lemmings 4</h4><p><img data-src="https://hdlbits.01xz.net/mw/images/e/e8/Lemmings4.gif" alt="Lemmings4.gif"></p><p>Although Lemmings can walk, fall, and dig, Lemmings aren't invulnerable. If a Lemming falls for too long then hits the ground, it can splatter. In particular, if a Lemming falls for more than 20 clock cycles then hits the ground, it will splatter and cease walking, falling, or digging (all 4 outputs become 0), forever (Or until the FSM gets reset). There is no upper limit on how far a Lemming can fall before hitting the ground. Lemmings only splatter when hitting the ground; they do not splatter in mid-air.</p><p>Extend your finite state machine to model this behaviour.</p><p>Falling for 20 cycles is survivable, Falling for 21 cycles causes splatter.</p><p>本题的难度在于，考虑下落过程需要设置计数器，判断是否超过 20 个时钟周期，这时边界条件就非常麻烦，同时<strong>计数器必须单独写在一个 <code>always</code> 语句块中，否则会报错</strong></p><p><em>对了，这一题比较坑的是计数器寄存器要足够大，否则会溢出！！！</em></p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> areset<span class="token punctuation">,</span>    <span class="token comment">// Freshly brainwashed Lemmings walk left.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> bump_left<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">input</span> bump_right<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">input</span> ground<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">input</span> dig<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">output</span> walk_left<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">output</span> walk_right<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">output</span> aaah<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">output</span> digging</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">parameter</span> L <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> R <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> FL <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> FR <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> DL <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> DR <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> WASTED <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    </pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    </pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fall_time_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    </pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            L<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>dig <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> DL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>bump_left <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            R<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>dig <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> DR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>bump_right <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            FL<span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="35"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    <span class="token function">if</span><span class="token punctuation">(</span>fall_time_cnt <span class="token operator">></span> <span class="token number">20</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> WASTED<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                    <span class="token keyword">else</span> next_state <span class="token operator">=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                <span class="token keyword">end</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            	<span class="token keyword">else</span> next_state <span class="token operator">=</span> FL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            FR<span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="41"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                    <span class="token function">if</span><span class="token punctuation">(</span>fall_time_cnt <span class="token operator">></span> <span class="token number">20</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> WASTED<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                    <span class="token keyword">else</span> next_state <span class="token operator">=</span> R<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token keyword">end</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> FR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            DL<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FL<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> DL<span class="token punctuation">;</span>                </pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="50"></td><td><pre>            DR<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>ground <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> FR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> DR<span class="token punctuation">;</span>                </pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="54"></td><td><pre>            WASTED<span class="token punctuation">:</span> next_state <span class="token operator">=</span> WASTED<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token keyword">default</span><span class="token punctuation">:</span> next_state <span class="token operator">=</span> state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    </pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">,</span> <span class="token keyword">posedge</span> areset<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>areset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> L<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token keyword">else</span> state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    </pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">,</span> <span class="token keyword">posedge</span> areset<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>areset<span class="token punctuation">)</span> fall_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>next_state <span class="token operator">==</span> FL <span class="token operator">||</span> next_state <span class="token operator">==</span> FR<span class="token punctuation">)</span> fall_time_cnt <span class="token operator">&lt;=</span> fall_time_cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token keyword">else</span> fall_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    </pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> WASTED<span class="token punctuation">)</span> <span class="token operator">&#123;</span>aaah<span class="token punctuation">,</span> walk_left<span class="token punctuation">,</span> walk_right<span class="token punctuation">,</span> digging<span class="token operator">&#125;</span> <span class="token operator">=</span> <span class="token number">4'b0000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token keyword">else</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="73"></td><td><pre>        	<span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> FL <span class="token operator">||</span> state <span class="token operator">==</span> FR<span class="token punctuation">)</span> aaah <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        	<span class="token keyword">else</span> aaah <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        	walk_left <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> L<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        	walk_right <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        	digging <span class="token operator">=</span> state <span class="token operator">==</span> DL <span class="token operator">||</span> state <span class="token operator">==</span> DR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="80"></td><td><pre>    </pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><h2 id="题组二ps2鼠标协议"><a class="anchor" href="#题组二ps2鼠标协议">#</a> 题组二：PS/2 鼠标协议</h2><h4 id="easy信息校验"><a class="anchor" href="#easy信息校验">#</a> Easy：信息校验</h4><p>The PS/2 mouse protocol sends messages that are three bytes long. However, within a continuous byte stream, it's not obvious where messages start and end. The only indication is that the first byte of each three byte message always has <code>bit[3]=1</code> (but bit[3] of the other two bytes may be 1 or 0 depending on data).</p><p>We want a finite state machine that will search for message boundaries when given an input byte stream. The algorithm we'll use is to discard bytes until we see one with <code>bit[3]=1</code> . We then assume that this is byte 1 of a message, and signal the receipt of a message once all 3 bytes have been received ( <code>done</code> ).</p><p>The FSM should signal <code>done</code> in the cycle immediately after the third byte of each message was successfully received.</p><p>注意题目的意思是，一直找到 <code>bit[3]=1</code> 的作为开始，然后读取两个 byte，这时候把 <code>done</code> 设置为 1 表示接受完毕，然后再一直找到下一个 <code>bit[3]=1</code> 重新开始，这是一个简单的 Moore 型状态机</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>    <span class="token comment">// Synchronous reset</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">output</span> done<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">parameter</span> S1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> S2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> S3 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> FINISH <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    </pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// State transition logic (combinational)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="14"></td><td><pre>            S1<span class="token punctuation">:</span> next_state <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> S2 <span class="token punctuation">:</span> S1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            S2<span class="token punctuation">:</span> next_state <span class="token operator">=</span> S3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            S3<span class="token punctuation">:</span> next_state <span class="token operator">=</span> FINISH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            FINISH<span class="token punctuation">:</span> next_state <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> S2 <span class="token punctuation">:</span> S1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// State flip-flops (sequential)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> S1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">else</span> state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="26"></td><td><pre> </pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">// Output logic</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">assign</span> done <span class="token operator">=</span> state <span class="token operator">==</span> FINISH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><h4 id="expert实现输出数据流"><a class="anchor" href="#expert实现输出数据流">#</a> Expert：实现输出数据流</h4><p>Now that you have a state machine that will identify three-byte messages in a PS/2 byte stream, add a datapath that will also output the 24-bit (3 byte) message whenever a packet is received ( <code>out_bytes[23:16]</code> is the first byte, <code>out_bytes[15:8]</code> is the second byte, etc.).</p><p><code>out_bytes</code> needs to be valid whenever the <code>done</code> signal is asserted. You may output anything at other times (i.e., don't-care).</p><p>要输出数据流，我们需要单独使用一组寄存器及时记录数据，但是要注意 FINISH 不一定会转移回 S1，也有可能转移回 S2，因此记录数据要特殊考虑</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> in<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>    <span class="token comment">// Synchronous reset</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_bytes<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">output</span> done<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// FSM from fsm_ps2</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">parameter</span> S1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> S2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> S3 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> FINISH <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    </pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> temp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// State transition logic (combinational)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="18"></td><td><pre>            S1<span class="token punctuation">:</span> next_state <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> S2 <span class="token punctuation">:</span> S1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            S2<span class="token punctuation">:</span> next_state <span class="token operator">=</span> S3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            S3<span class="token punctuation">:</span> next_state <span class="token operator">=</span> FINISH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            FINISH<span class="token punctuation">:</span> next_state <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> S2 <span class="token punctuation">:</span> S1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment">// State flip-flops (sequential)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> S1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">else</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            out_bytes <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> FINISH<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> temp<span class="token punctuation">;</span>		<span class="token comment">// 其实也没必要这样，因为题意是 done 不是 1 时输出什么都无所谓</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    </pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            S3<span class="token punctuation">:</span> temp<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            S2<span class="token punctuation">:</span> temp<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            S1<span class="token punctuation">:</span> temp<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token keyword">default</span><span class="token punctuation">:</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> FINISH <span class="token operator">&amp;&amp;</span> next_state <span class="token operator">==</span> S2<span class="token punctuation">)</span> temp<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">// 这里就是特殊判断上述分析中的情况</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            </pre></td></tr><tr><td data-num="44"></td><td><pre> </pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token comment">// Output logic</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">assign</span> done <span class="token operator">=</span> state <span class="token operator">==</span> FINISH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token comment">// New: Datapath to store incoming bytes.</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><h3 id="题组三通信协议"><a class="anchor" href="#题组三通信协议">#</a> 题组三：通信协议</h3><h4 id="normal数据校验"><a class="anchor" href="#normal数据校验">#</a> Normal：数据校验</h4><p>In many (older) serial communications protocols, each data byte is sent along with a start bit and a stop bit, to help the receiver delimit bytes from the stream of bits. One common scheme is to use one start bit (0), 8 data bits, and 1 stop bit (1). The line is also at logic 1 when nothing is being transmitted (idle).</p><p>Design a finite state machine that will identify when bytes have been correctly received when given a stream of bits. It needs to identify the start bit, wait for all 8 data bits, then verify that the stop bit was correct. If the stop bit does not appear when expected, the FSM must wait until it finds a stop bit before attempting to receive the next byte.</p><p>跟上面一组题类似，注意考虑何时将 done 置为 1，另外本题就使用了 Lemmings 4 中的计数器方法，因为要重复读取 8 个字符</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> in<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>    <span class="token comment">// Synchronous reset</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">output</span> done</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">parameter</span> START <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> WAIT <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> DONE <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> ERROR <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> wait_time_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            START<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> WAIT <span class="token punctuation">:</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            WAIT<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>wait_time_cnt <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> DONE <span class="token punctuation">:</span> ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> WAIT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            DONE<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> WAIT <span class="token punctuation">:</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            ERROR<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> START <span class="token punctuation">:</span> ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    </pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">else</span> state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    </pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> wait_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>next_state <span class="token operator">==</span> WAIT<span class="token punctuation">)</span> wait_time_cnt <span class="token operator">&lt;=</span> wait_time_cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">else</span> wait_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    </pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">assign</span> done <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> DONE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><h4 id="expert输出数据流"><a class="anchor" href="#expert输出数据流">#</a> Expert：输出数据流</h4><p>Now that you have a finite state machine that can identify when bytes are correctly received in a serial bitstream, add a datapath that will output the correctly-received data byte. <code>out_byte</code> needs to be valid when <code>done</code> is <code>1</code> , and is don't-care otherwise.</p><p>Note that the serial protocol sends the <em>least</em> significant bit first.</p><p>这里注意何时输出，在我的代码里需要当 <code>next_state == DONE</code> 时输出，这样可以防止把最后一个符号位 1 也读进去</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> in<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>    <span class="token comment">// Synchronous reset</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_byte<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">output</span> done</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// Use FSM from Fsm_serial</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">parameter</span> START <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> WAIT <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> DONE <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> ERROR <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> wait_time_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> temp_list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            START<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> WAIT <span class="token punctuation">:</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            WAIT<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>wait_time_cnt <span class="token operator">></span> <span class="token number">7</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> DONE <span class="token punctuation">:</span> ERROR<span class="token punctuation">;</span>		<span class="token comment">// 读入第 8 个数据时就要考虑下一个状态是啥了</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> WAIT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            DONE<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> WAIT <span class="token punctuation">:</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            ERROR<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> START <span class="token punctuation">:</span> ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    </pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">else</span> state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>next_state <span class="token operator">==</span> DONE<span class="token punctuation">)</span> out_byte <span class="token operator">&lt;=</span> temp_list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">else</span> out_byte <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    </pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> wait_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> WAIT<span class="token punctuation">)</span> wait_time_cnt <span class="token operator">&lt;=</span> wait_time_cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token keyword">else</span> wait_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    </pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> WAIT<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            temp_list<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&#123;</span>in<span class="token punctuation">,</span> temp_list<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    </pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">assign</span> done <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> DONE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token comment">// New: Datapath to latch input bits.</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><h4 id="lunatic奇偶校验"><a class="anchor" href="#lunatic奇偶校验">#</a> Lunatic：奇偶校验</h4><p>We want to add parity checking to the serial receiver. Parity checking adds one extra bit after each data byte. We will use odd parity, where the number of <code>1</code> s in the 9 bits received must be odd. For example, <code>101001011</code> satisfies odd parity (there are 5 <code>1</code> s), but <code>001001011</code> does not.</p><p>Change your FSM and datapath to perform odd parity checking. Assert the <code>done</code> signal only if a byte is correctly received <em>and</em> its parity check passes. Like the <span class="exturl" data-url="aHR0cHM6Ly9oZGxiaXRzLjAxeHoubmV0L3dpa2kvZnNtX3NlcmlhbA==">serial receiver FSM</span>, this FSM needs to identify the start bit, wait for all 9 (data and parity) bits, then verify that the stop bit was correct. If the stop bit does not appear when expected, the FSM must wait until it finds a stop bit before attempting to receive the next byte.</p><p>You are provided with the following module that can be used to calculate the parity of the input stream (It's a TFF with reset). The intended use is that it should be given the input bit stream, and reset at appropriate times so it counts the number of <code>1</code> bits in each byte.</p><pre><code>module parity (
    input clk,
    input reset,
    input in,
    output reg odd);

    always @(posedge clk)
        if (reset) odd &lt;= 0;
        else if (in) odd &lt;= ~odd;

endmodule
</code></pre><p>Note that the serial protocol sends the least significant bit first, and the parity bit after the 8 data bits.</p><p><s>刚开始貌似脑袋坏掉了，做了半天，重构一遍代码之后想起来好像扩充状态数后 reg 的长度没增加...... 最近睡得有点少......</s></p><p>但是实际上这一题不需要增加状态数，可以把奇偶校验位放在 WAIT 状态中处理</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> in<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>    <span class="token comment">// Synchronous reset</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> out_byte<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">output</span> done</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// Use FSM from Fsm_serial</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">parameter</span> START <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> WAIT <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> DONE <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> ERROR <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> wait_time_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> temp_list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">reg</span> parity_checker<span class="token punctuation">,</span> parity_ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    </pre></td></tr><tr><td data-num="16"></td><td><pre>    parity <span class="token function">parity_check</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>state <span class="token operator">==</span> WAIT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">odd</span><span class="token punctuation">(</span>parity_checker<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    </pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            START<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> WAIT <span class="token punctuation">:</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            WAIT<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>wait_time_cnt <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> DONE <span class="token punctuation">:</span> ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> WAIT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            DONE<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> WAIT <span class="token punctuation">:</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            ERROR<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> START <span class="token punctuation">:</span> ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    </pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token keyword">else</span> state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>next_state <span class="token operator">==</span> DONE<span class="token punctuation">)</span> out_byte <span class="token operator">&lt;=</span> temp_list<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">else</span> out_byte <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    </pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> wait_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> WAIT<span class="token punctuation">)</span> wait_time_cnt <span class="token operator">&lt;=</span> wait_time_cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">else</span> wait_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>wait_time_cnt <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span> parity_ans <span class="token operator">&lt;=</span> parity_checker<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    </pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> WAIT <span class="token operator">&amp;&amp;</span> wait_time_cnt <span class="token operator">!=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            temp_list<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&#123;</span>in<span class="token punctuation">,</span> temp_list<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    </pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">assign</span> done <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> DONE<span class="token punctuation">)</span> <span class="token operator">&amp;</span> parity_ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token comment">// New: Datapath to latch input bits.</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><h3 id="关于序列识别"><a class="anchor" href="#关于序列识别">#</a> 关于序列识别</h3><blockquote><p>注意到课上测试和课下测试中关于 FSM 的题目大部分都是正则表达式匹配和自动售货机问题，这里单独把序列识别拎出来分析一下</p></blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSGlnaC1MZXZlbF9EYXRhX0xpbmtfQ29udHJvbCNTeW5jaHJvbm91c19mcmFtaW5n">Synchronous HDLC framing</span> involves decoding a continuous bit stream of data to look for bit patterns that indicate the beginning and end of frames (packets). Seeing exactly 6 consecutive 1s (i.e., <code>01111110</code> ) is a &quot;flag&quot; that indicate frame boundaries. To avoid the data stream from accidentally containing &quot;flags&quot;, the sender inserts a zero after every 5 consecutive 1s which the receiver must detect and discard. We also need to signal an error if there are 7 or more consecutive 1s.</p><p>Create a finite state machine to recognize these three sequences:</p><ul><li><code>0111110</code> : Signal a bit needs to be discarded ( <code>disc</code> ).</li><li><code>01111110</code> : Flag the beginning/end of a frame ( <code>flag</code> ).</li><li><code>01111111...</code> : Error (7 or more 1s) ( <code>err</code> ).</li></ul><p>When the FSM is reset, it should be in a state that behaves as though the previous input were 0.</p><p>Implement this state machine.</p><p>目标是识别所有的 <code>01111110</code> 结尾的序列，并标记为 <code>disc</code> ，这种序列用正则表达式可以写为 <code>^01&#123;6&#125;0</code></p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">module</span> <span class="token function">top_module</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">input</span> clk<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">input</span> reset<span class="token punctuation">,</span>    <span class="token comment">// Synchronous reset</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">input</span> in<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">output</span> disc<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">output</span> flag<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">output</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    </pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">parameter</span> START <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> WAIT <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">reg</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> wait_time_cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    </pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="15"></td><td><pre>            START<span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> WAIT <span class="token punctuation">:</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            WAIT<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token function">if</span><span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> WAIT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token keyword">else</span> next_state <span class="token operator">=</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    </pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> state <span class="token operator">&lt;=</span> START<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">else</span> state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    </pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token operator">&#123;</span>disc<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> err<span class="token operator">&#125;</span> <span class="token operator">&lt;=</span> <span class="token number">3'b000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">else</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="32"></td><td><pre>                START<span class="token punctuation">:</span><span class="token operator">&#123;</span>disc<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> err<span class="token operator">&#125;</span> <span class="token operator">&lt;=</span> <span class="token number">3'b000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        	    WAIT<span class="token punctuation">:</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                    <span class="token function">if</span><span class="token punctuation">(</span>wait_time_cnt <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> next_state <span class="token operator">==</span> START<span class="token punctuation">)</span> <span class="token operator">&#123;</span>disc<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> err<span class="token operator">&#125;</span> <span class="token operator">&lt;=</span> <span class="token number">3'b100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>wait_time_cnt <span class="token operator">==</span> <span class="token number">6</span> <span class="token operator">&amp;&amp;</span> next_state <span class="token operator">==</span> START<span class="token punctuation">)</span> <span class="token operator">&#123;</span>disc<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> err<span class="token operator">&#125;</span> <span class="token operator">&lt;=</span> <span class="token number">3'b010</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>wait_time_cnt <span class="token operator">></span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> next_state <span class="token operator">==</span> WAIT<span class="token punctuation">)</span> <span class="token operator">&#123;</span>disc<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> err<span class="token operator">&#125;</span> <span class="token operator">&lt;=</span> <span class="token number">3'b001</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                    <span class="token keyword">else</span> <span class="token operator">&#123;</span>disc<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> err<span class="token operator">&#125;</span> <span class="token operator">&lt;=</span> <span class="token number">3'b000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            	<span class="token keyword">end</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        	<span class="token keyword">endcase</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    	<span class="token keyword">end</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    </pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> wait_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>next_state <span class="token operator">==</span> WAIT<span class="token punctuation">)</span> wait_time_cnt <span class="token operator">&lt;=</span> wait_time_cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">else</span> wait_time_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token keyword">endmodule</span></pre></td></tr></table></figure><p>受不了这个计数器方法了，我调了一个小时可还行...... 下次我直接这样做......</p><p><img data-src="https://hdlbits.01xz.net/mw/images/4/47/Fsm_hdlc.png" alt="Fsm hdlc.png"></p><div class="tags"><a href="/tags/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" rel="tag"><i class="ic i-tag"></i> 北航计算机组成原理</a> <a href="/tags/Verilog/" rel="tag"><i class="ic i-tag"></i> Verilog</a> <a href="/tags/Pre%E8%AF%BE%E4%B8%8B/" rel="tag"><i class="ic i-tag"></i> Pre课下</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-10-20 21:58:56" itemprop="dateModified" datetime="2021-10-20T21:58:56+08:00">2021-10-20</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="FL 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="FL 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="FL 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>FL <i class="ic i-at"><em>@</em></i>FlyingLandlord's Blog</li><li class="link"><strong>本文链接：</strong> <a href="http://flyinglandlord.github.io/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part2)/" title="Verilog 学习笔记（2）">http://flyinglandlord.github.io/2021/09/25/BUAA-CO-2021/Pre/Verilog学习笔记-练习题总结(Part2)/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part1)/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?type&#x3D;wallpaper&amp;size&#x3D;1920x1080?4974" title="Verilog 学习笔记（1）"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 北航计算机组成原理</span><h3>Verilog 学习笔记（1）</h3></a></div><div class="item right"><a href="/2021/09/30/BUAA-CO-2021/Pre/%E8%B0%88%E4%B8%80%E8%B0%88MIPS%E6%B1%87%E7%BC%96Challenge%E9%A2%98/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?type&#x3D;wallpaper&amp;size&#x3D;1920x1080?502946" title="MIPS汇编哈密顿回路"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 北航计算机组成原理</span><h3>MIPS汇编哈密顿回路</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#verilog-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93part-2"><span class="toc-number">1.</span> <span class="toc-text">Verilog 学习笔记 - 练习题总结（Part 2）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BAfsm"><span class="toc-number">1.1.</span> <span class="toc-text">有限状态机 (FSM)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%BB%84%E4%B8%80lemmings%E6%B8%B8%E6%88%8F"><span class="toc-number">1.1.1.</span> <span class="toc-text">题组一：Lemmings 游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%9D%A5%E6%BA%90hdlbits-examsece241_2013_q4"><span class="toc-number">1.1.2.</span> <span class="toc-text">题目来源：hdlbits, exams&#x2F;ece241_2013_q4</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#easy-lemmings-1"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">Easy: Lemmings 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hard-lemmings-2"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">Hard: Lemmings 2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#expert-lemmings-3"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">Expert: Lemmings 3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#special-lemmings-4"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">Special: Lemmings 4</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%BB%84%E4%BA%8Cps2%E9%BC%A0%E6%A0%87%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.</span> <span class="toc-text">题组二：PS&#x2F;2 鼠标协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#easy%E4%BF%A1%E6%81%AF%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">Easy：信息校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#expert%E5%AE%9E%E7%8E%B0%E8%BE%93%E5%87%BA%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number">1.2.0.2.</span> <span class="toc-text">Expert：实现输出数据流</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%BB%84%E4%B8%89%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.1.</span> <span class="toc-text">题组三：通信协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#normal%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">Normal：数据校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#expert%E8%BE%93%E5%87%BA%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">Expert：输出数据流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lunatic%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">Lunatic：奇偶校验</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%BA%8F%E5%88%97%E8%AF%86%E5%88%AB"><span class="toc-number">1.2.2.</span> <span class="toc-text">关于序列识别</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/09/15/BUAA-CO-2021/Pre/Logisim%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" rel="bookmark" title="Logisim斐波那契电路">Logisim斐波那契电路</a></li><li><a href="/2021/09/25/BUAA-CO-2021/Pre/%E5%85%B3%E4%BA%8ECPU%E8%BE%93%E5%87%BA%E5%BA%8F%E5%88%97%E6%A3%80%E6%9F%A5%E9%A2%98%E7%9A%84%E8%B0%83%E8%AF%95%E5%BB%BA%E8%AE%AE/" rel="bookmark" title="CPU输出序列检查调试方法">CPU输出序列检查调试方法</a></li><li><a href="/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part1)/" rel="bookmark" title="Verilog 学习笔记（1）">Verilog 学习笔记（1）</a></li><li class="active"><a href="/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part2)/" rel="bookmark" title="Verilog 学习笔记（2）">Verilog 学习笔记（2）</a></li><li><a href="/2021/09/30/BUAA-CO-2021/Pre/%E8%B0%88%E4%B8%80%E8%B0%88MIPS%E6%B1%87%E7%BC%96Challenge%E9%A2%98/" rel="bookmark" title="MIPS汇编哈密顿回路">MIPS汇编哈密顿回路</a></li><li><a href="/2021/10/13/BUAA-CO-2021/Pre/Logisim%E5%A4%8D%E4%B9%A0/" rel="bookmark" title="Logisim Pre考前复习">Logisim Pre考前复习</a></li><li><a href="/2021/10/13/BUAA-CO-2021/Pre/Verilog%E5%A4%8D%E4%B9%A0/" rel="bookmark" title="Verilog Pre考前复习">Verilog Pre考前复习</a></li><li><a href="/2021/10/13/BUAA-CO-2021/Pre/Pre%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95/" rel="bookmark" title="Pre课上测试游记">Pre课上测试游记</a></li><li><a href="/2021/10/20/BUAA-CO-2021/P0/P0%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" rel="bookmark" title="P0课上测试游记">P0课上测试游记</a></li><li><a href="/2021/10/24/BUAA-CO-2021/P1/P1%E8%AF%BE%E4%B8%8B%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="P1课下学习">P1课下学习</a></li><li><a href="/2021/10/27/BUAA-CO-2021/P1/P1%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" rel="bookmark" title="P1课上测试游记">P1课上测试游记</a></li><li><a href="/2021/11/01/BUAA-CO-2021/P2/P2%E8%AF%BE%E4%B8%8B%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="P2课下学习">P2课下学习</a></li><li><a href="/2021/11/03/BUAA-CO-2021/P2/P2%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" rel="bookmark" title="P2课上测试游记">P2课上测试游记</a></li><li><a href="/2021/11/10/BUAA-CO-2021/P3/P3%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" rel="bookmark" title="P3课上测试游记">P3课上测试游记</a></li><li><a href="/2021/11/13/BUAA-CO-2021/P3/CPU%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/" rel="bookmark" title="P3课下学习—单周期CPU设计(1)">P3课下学习—单周期CPU设计(1)</a></li><li><a href="/2021/11/13/BUAA-CO-2021/P4/CPU%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/" rel="bookmark" title="P4课下学习—单周期CPU设计(2)">P4课下学习—单周期CPU设计(2)</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="FL" data-src="/images/avatar.jpg"><p class="name" itemprop="name">FL</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">17</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">4</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">19</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZseWluZ2xhbmRsb3Jk" title="https:&#x2F;&#x2F;github.com&#x2F;flyinglandlord"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjI2NDUzNzcxNjFAcXEuY29t" title="mailto:2645377161@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part1)/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/09/30/BUAA-CO-2021/Pre/%E8%B0%88%E4%B8%80%E8%B0%88MIPS%E6%B1%87%E7%BC%96Challenge%E9%A2%98/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/10/27/BUAA-CO-2021/P1/P1%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" title="P1课上测试游记">P1课上测试游记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/09/30/BUAA-CO-2021/Pre/%E8%B0%88%E4%B8%80%E8%B0%88MIPS%E6%B1%87%E7%BC%96Challenge%E9%A2%98/" title="MIPS汇编哈密顿回路">MIPS汇编哈密顿回路</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/10/13/BUAA-CO-2021/Pre/Logisim%E5%A4%8D%E4%B9%A0/" title="Logisim Pre考前复习">Logisim Pre考前复习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/10/13/BUAA-CO-2021/Pre/Pre%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95/" title="Pre课上测试游记">Pre课上测试游记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/10/24/BUAA-CO-2021/P1/P1%E8%AF%BE%E4%B8%8B%E5%AD%A6%E4%B9%A0/" title="P1课下学习">P1课下学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/11/10/BUAA-CO-2021/P3/P3%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" title="P3课上测试游记">P3课上测试游记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part1)/" title="Verilog 学习笔记（1）">Verilog 学习笔记（1）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part2)/" title="Verilog 学习笔记（2）">Verilog 学习笔记（2）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/11/03/BUAA-CO-2021/P2/P2%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" title="P2课上测试游记">P2课上测试游记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/11/13/BUAA-CO-2021/P3/CPU%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/" title="P3课下学习—单周期CPU设计(1)">P3课下学习—单周期CPU设计(1)</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">FL @ Test Blog</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/09/25/BUAA-CO-2021/Pre/Verilog学习笔记-练习题总结(Part2)/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>