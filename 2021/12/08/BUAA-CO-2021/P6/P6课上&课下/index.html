<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="FlyingLandlord's Blog" href="http://flyinglandlord.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="FlyingLandlord's Blog" href="http://flyinglandlord.github.io/atom.xml"><link rel="alternate" type="application/json" title="FlyingLandlord's Blog" href="http://flyinglandlord.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="北航计算机组成原理,Verilog,MIPS,流水线CPU,P6课上,P6课下"><link rel="canonical" href="http://flyinglandlord.github.io/2021/12/08/BUAA-CO-2021/P6/P6%E8%AF%BE%E4%B8%8A&%E8%AF%BE%E4%B8%8B/"><title>P6 课下 & 课上总结 - 北航计算机组成原理 | Test Blog = FlyingLandlord's Blog</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">P6 课下 & 课上总结</h1><div class="meta"><span class="item" title="创建时间：2021-12-08 22:45:45"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-12-08T22:45:45+08:00">2021-12-08</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Test Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?727048"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?621362"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?192034"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?394053"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?767222"></li><li class="item" data-background-image="https://api.yimian.xyz/img?type=wallpaper&size=1920x1080?550107"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" itemprop="item" rel="index" title="分类于 北航计算机组成原理"><span itemprop="name">北航计算机组成原理</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://flyinglandlord.github.io/2021/12/08/BUAA-CO-2021/P6/P6%E8%AF%BE%E4%B8%8A&%E8%AF%BE%E4%B8%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="FL"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="FlyingLandlord's Blog"></span><div class="body md" itemprop="articleBody"><h1 id="p6较完善的流水线cpu设计"><a class="anchor" href="#p6较完善的流水线cpu设计">#</a> P6：较完善的流水线 CPU 设计</h1><div class="note warning"><p>通过阅读本文，您可以大致了解 2021 年秋季北航计算机组成课程 P6 课下搭建的思路，以及课上测试的题目内容、难度和解题思路<br>P6 课上测试的主要内容是对课下用 Verilog 搭建的流水线 CPU 进行强测，同时添加一些新指令<br>题目每年都会发生变化，题意描述可能与原题有一定差异</p></div><p></p><div class="media-container"><div class="player" data-type="audio" data-src='[{"title":"Something","list":["https://music.163.com/#/song?id=31967335","https://music.163.com/#/song?id=533455147"]}]'></div></div><p></p><h2 id="课下部分"><a class="anchor" href="#课下部分">#</a> 课下部分</h2><p>P5 已经完成了流水线的大部分框架性工作了，P6 要做的主要就是三件事：按照教程要求改造 DM，添加乘除槽以及添加大量指令</p><p>要求实现的指令集为 <code>MIPS-C3</code> ，即<strong> LB、LBU、LH、LHU、LW、SB、SH、SW、ADD、ADDU、 SUB、SUBU、MULT、MULTU、DIV、DIVU、SLL、SRL、SRA、SLLV、 SRLV、SRAV、AND、OR、XOR、NOR、ADDI、ADDIU、ANDI、ORI、 XORI、LUI、SLT、SLTI、SLTIU、SLTU、BEQ、BNE、BLEZ、BGTZ、 BLTZ、BGEZ、J、JAL、JALR、JR、MFHI、MFLO、MTHI、MTLO</strong>，可以看出已经包括了除了浮点数运算和 CP0 协处理器之外的所有指令</p><p>第一件事情，也是最容易做的就是添加运算类的和跳转类的指令了，由于支持的指令非常非常多，建议用宏的方式，定义每一条指令的 <code>opcode</code> 和 <code>funct</code> ，例如单独建立一个文件 <code>def.v</code> 用于定义所有的控制信号和指令的 <code>opcode</code> 和 <code>funct</code> ，尽量避免在程序主体部分出现 magic number</p><p>跳转类的只需要添加 b 类跳转，由于按照 P5 的架构，由 D 级的 CMP 判断是否需要跳转，那么我们只需要修改 <code>CMP</code> 即可支持所有的指令</p><p>运算类的需要修改 <code>ALU</code> ，这里非常容易出现<strong>有符号数、无符号数， <code>$signed</code> ， <code>$unsigned</code> 的符号问题</strong>，建议根据课下给出的弱测数据逐一进行功能测试，确保无问题</p><p>由于 P5 的阻塞和转发是对于某一类指令做的，添加上面两类指令时必然不会出现其它新的转发阻塞问题，因此只需要将他们加到原有分类中即可</p><div class="note warning"><p>需要特别注意 <code>SLL、SRL、SRA、SLLV、SRLV、SRA</code> 这些指令，因为如果不可变的移位指令如 <code>SLL、SRL、SRA</code> ，符号是一方面问题，更重要的是他们无需使用 <code>$rs</code> 寄存器，在阻塞的时候需要特别考虑</p></div><p>对于上面的问题，解决方案是单独分出两类，然后阻塞特殊判断，代码如下：</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// control.v</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">assign</span> shift_s <span class="token operator">=</span> sll <span class="token operator">|</span> srl <span class="token operator">|</span> sra<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">assign</span> shift_v <span class="token operator">=</span> sllv <span class="token operator">|</span> srlv <span class="token operator">|</span> srav<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// stall.v</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">assign</span> D_Tuse_rt <span class="token operator">=</span> <span class="token punctuation">(</span>D_branch<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'd0</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                   <span class="token punctuation">(</span>D_calc_r <span class="token operator">|</span> D_md<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'd1</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                   <span class="token punctuation">(</span>D_store<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'd2</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                   <span class="token number">8'd3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">assign</span> D_Tuse_rs <span class="token operator">=</span> <span class="token punctuation">(</span>D_branch <span class="token operator">|</span> D_jump_reg<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'd0</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                   <span class="token punctuation">(</span>D_calc_i <span class="token operator">|</span> <span class="token punctuation">(</span>D_calc_r <span class="token operator">&amp;</span> <span class="token operator">!</span>D_shift_s<span class="token punctuation">)</span> <span class="token operator">|</span> D_load <span class="token operator">|</span> D_store <span class="token operator">|</span> D_mt <span class="token operator">|</span> D_md<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'd1</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                   <span class="token number">8'd3</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>第二件事情是实现乘除槽，我们需要模拟乘除法的时延，因此乘法需要慢 5 个周期，除法需要慢 10 个周期，乘除槽有天然的 HI 和 LO 两个寄存器，因此除了 <code>mflo, mfhi, mthi, mtlo</code> 不需要考虑转发，但是需要考虑阻塞，我们这样做</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// control.v</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">assign</span> md <span class="token operator">=</span> mult <span class="token operator">|</span> multu <span class="token operator">|</span> div <span class="token operator">|</span> divu<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">assign</span> mt <span class="token operator">=</span> mtlo <span class="token operator">|</span> mthi<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">assign</span> mf <span class="token operator">=</span> mflo <span class="token operator">|</span> mfhi<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// stall.v</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">wire</span> E_stall_mdu <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>D_md <span class="token operator">|</span> D_mt <span class="token operator">|</span> D_mf<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>E_MDU_Busy <span class="token operator">|</span> E_MDU_Start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">assign</span> Stall <span class="token operator">=</span> E_stall_rs <span class="token operator">|</span> E_stall_rt <span class="token operator">|</span> M_stall_rs <span class="token operator">|</span> M_stall_rt <span class="token operator">|</span> E_stall_mdu<span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>注意在乘除槽处于运算过程中时，如果 D 级出现了任何与乘除槽有关的指令，我们都必须阻塞！</strong></p><p>此外对于乘除槽内部，我们维护一个 <code>tmp_HI</code> 和 <code>tmp_LO</code> ，乘法需要慢 5 个周期，除法需要慢 10 个周期只是假象，我们在第一个周期就能算出结果，只是我们给他存入 <code>tmp_HI</code> 和 <code>tmp_LO</code> 里面，到规定的时延之后我们再把他们转存到 <code>HI</code> 和 <code>LO</code> 里面，像这样</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">if</span><span class="token punctuation">(</span>cycle_cnt <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token function">if</span><span class="token punctuation">(</span>Start<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		Busy <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_multu</span> <span class="token operator">||</span> MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_mult</span><span class="token punctuation">)</span> cycle_cnt <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_div</span> <span class="token operator">||</span> MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_divu</span><span class="token punctuation">)</span> cycle_cnt <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        </pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token function">if</span><span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_multu</span><span class="token punctuation">)</span> <span class="token operator">&#123;</span>tmp_HI<span class="token punctuation">,</span> tmp_LO<span class="token operator">&#125;</span> <span class="token operator">&lt;=</span> D1 <span class="token operator">*</span> D2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_mult</span><span class="token punctuation">)</span> <span class="token operator">&#123;</span>tmp_HI<span class="token punctuation">,</span> tmp_LO<span class="token operator">&#125;</span> <span class="token operator">&lt;=</span> <span class="token property">$signed</span><span class="token punctuation">(</span>D1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token property">$signed</span><span class="token punctuation">(</span>D2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_div</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        	tmp_LO <span class="token operator">&lt;=</span> <span class="token property">$signed</span><span class="token punctuation">(</span>D1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token property">$signed</span><span class="token punctuation">(</span>D2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            tmp_HI <span class="token operator">&lt;=</span> <span class="token property">$signed</span><span class="token punctuation">(</span>D1<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token property">$signed</span><span class="token punctuation">(</span>D2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_divu</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            tmp_LO <span class="token operator">&lt;=</span> D1 <span class="token operator">/</span> D2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            tmp_HI <span class="token operator">&lt;=</span> D1 <span class="token operator">%</span> D2<span class="token punctuation">;</span>              </pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">end</span>    </pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		cycle_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token keyword">end</span></pre></td></tr></table></figure><p>然后就是正常的状态机，每一次时钟上升沿 <code>cycle_cnt</code> 都会减 1，减到 1 的时候把 <code>tmp_HI</code> 和 <code>tmp_LO</code> 转存</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">if</span><span class="token punctuation">(</span>cycle_cnt <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	LO <span class="token operator">&lt;=</span> tmp_LO<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    HI <span class="token operator">&lt;=</span> tmp_HI<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    Busy <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    cycle_cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    cycle_cnt <span class="token operator">&lt;=</span> cycle_cnt <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><p>第三件事 DM 改造，课程组今年已经给出了标准的 DM 实现，我们只需要调用对应的接口即可</p><p>这里我们用 <code>BE</code> 处理要写入的数据，使其符合规范，用 <code>DE</code> 处理读出的数据，使其符合 <code>lh, lb, lhu, lbu, lw, lw</code> 的要求</p><p>BE 的端口</p><table><thead><tr><th>信号名称</th><th>方向</th><th>功能描述</th></tr></thead><tbody><tr><td>BEOp[1:0]</td><td>输入</td><td>控制信号</td></tr><tr><td>Addr[31:0]</td><td>输入</td><td>地址信息，用于处理半字、字节</td></tr><tr><td>rt_data[31:0]</td><td>输入</td><td>读取的寄存器数据，待处理</td></tr><tr><td>DMWrEn</td><td>输入</td><td>写使能</td></tr><tr><td>m_data_byteen[3:0]</td><td>输出</td><td>控制写入半字、字节的位置位置</td></tr><tr><td>m_data_wdata[31:0]</td><td>输出</td><td>待写入数据</td></tr></tbody></table><p>DE 的端口</p><table><thead><tr><th>信号名称</th><th>方向</th><th>功能描述</th></tr></thead><tbody><tr><td>DEOp[1:0]</td><td>输入</td><td>控制信号</td></tr><tr><td>Addr[31:0]</td><td>输入</td><td>地址信息，用于处理半字、字节</td></tr><tr><td>m_data_rdata[31:0]</td><td>输入</td><td><code>mips_txt.v</code> 返回的 DM 中的数据</td></tr><tr><td>DMRD[31:0]</td><td>输出</td><td>处理之后的正确的读取数据</td></tr></tbody></table><p>与接口进行交互的细节代码</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 与 DM 交互</span></pre></td></tr><tr><td data-num="2"></td><td><pre>M_BE <span class="token function">_be</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">BEOp</span><span class="token punctuation">(</span>M_BEOp<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">Addr</span><span class="token punctuation">(</span>M_ALUAns<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">rt_data</span><span class="token punctuation">(</span>M_FWD_rt_data<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">m_data_byteen</span><span class="token punctuation">(</span>m_data_byteen<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">m_data_wdata</span><span class="token punctuation">(</span>m_data_wdata<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">assign</span> m_inst_addr <span class="token operator">=</span> M_PC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">assign</span> m_data_addr <span class="token operator">=</span> M_ALUAns<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> M_DMRD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>M_DE <span class="token function">_de</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">DEOp</span><span class="token punctuation">(</span>M_DEOp<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">Addr</span><span class="token punctuation">(</span>M_ALUAns<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">m_data_rdata</span><span class="token punctuation">(</span>m_data_rdata<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">DMRD</span><span class="token punctuation">(</span>M_DMRD<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">// 正确输出 GRF 读写信息</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">assign</span> w_grf_addr <span class="token operator">=</span> W_GRFA3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">assign</span> w_grf_wdata <span class="token operator">=</span> W_GRFWD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">assign</span> w_grf_we <span class="token operator">=</span> W_GRFWrEn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">assign</span> w_inst_addr <span class="token operator">=</span> W_PC<span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>注意今年的 P6 也不需要在寄存器堆里面输出写入信息了，同样是调用 <code>mips_tb.v</code> 的接口即可</strong></p><p>这一部分仔细读一读教程，然后在看一看提供的源代码就行，问题不大</p><h2 id="课上部分"><a class="anchor" href="#课上部分">#</a> 课上部分</h2><p>题目的考察离不开 P5 的那几种类型，逐一进行解释</p><div class="note danger"><p>个人的一些想法：<br>关于课上测试的准备，自己练习加的指令不求多，因为反正不可能考到原题，要更加熟悉你自己设计的流水线的架构，理解阻塞和转发的过程，做到心中有图，然后自己可以想一想如何添加，多想几种方法，找一个最方便的形成自己的套路，就足以应对课上测试了<br>并不一定需要真正把指令加到 CPU 里面，这有可能会引入潜在的 bug，而且你没有.class 文件也没法做测试，出了问题除了让自己血压升高没别的好处<br>下面的总结和套路也仅供参考，但是至少顺利通过了 P5 和 P6 的课上测试</p></div><h3 id="第一类运算类"><a class="anchor" href="#第一类运算类">#</a> 第一类：运算类</h3><h4 id="shl-swap-hi-lo"><a class="anchor" href="#shl-swap-hi-lo">#</a> shl (swap HI LO)</h4><p>这是第一次课上考试的题目，要求是交换 HI、LO 寄存器的值</p><p>可以直接这样加（注意非阻塞赋值的运用），非常容易</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">if</span><span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_shl</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    HI <span class="token operator">&lt;=</span> LO<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    LO <span class="token operator">&lt;=</span> HI<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><h4 id="bds-big-divideunsigned-small"><a class="anchor" href="#bds-big-divideunsigned-small">#</a> bds (big divide(unsigned) small)</h4><p>给出 <code>rs</code> 和 <code>rt</code> 两个寄存器，用较大的那个数除以较小的那个数，<strong>注意是无符号除法</strong></p><p>这是第二次课上考试的题目，也非常容易（注意无符号）</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">if</span><span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_bds</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">if</span><span class="token punctuation">(</span>D1 <span class="token operator">></span> D2<span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        tmp_LO <span class="token operator">&lt;=</span> D1 <span class="token operator">/</span> D2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        tmp_HI <span class="token operator">&lt;=</span> D1 <span class="token operator">%</span> D2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        tmp_LO <span class="token operator">&lt;=</span> D2 <span class="token operator">/</span> D1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        tmp_HI <span class="token operator">&lt;=</span> D2 <span class="token operator">%</span> D1<span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><p><strong>可以看出主要是关于乘除槽的计算，只要熟悉乘除槽的工作原理，第一题不难做出</strong></p><h3 id="第二类条件跳转"><a class="anchor" href="#第二类条件跳转">#</a> 第二类：条件跳转</h3><h4 id="bezal"><a class="anchor" href="#bezal">#</a> bezal</h4><p><strong>指令描述</strong></p><table><thead><tr><th>special</th><th>rs</th><th>rt</th><th>0</th><th>0</th><th>funct</th></tr></thead><tbody><tr><td>000000</td><td>rs 寄存器地址</td><td>rt 寄存器地址</td><td>00000</td><td>00000</td><td>110001</td></tr></tbody></table><p><strong>指令行为</strong></p><p>若 <code>GPR[rt] = 0</code> ，则跳转到 <code>GPR[rs]</code> ，并且链接到 <code>GPR[31]</code></p><p><strong>解法</strong></p><p>这是第二次上机考试的题目</p><p>对于条件跳转的题目，有<strong>两个不同性质：条件链接 / 无条件链接，清空 / 不清空延迟槽</strong>，本题显然是条件链接 + 不清空延迟槽</p><p>而且由于在 D 级我们就可以获得是否跳转，因此我们只需要修改 <code>NPC</code> 和 <code>CMP</code> 两个元件，明确 ** <code>CMP</code> 是用来比较产生是否跳转的结果的， <code>NPC</code> 是根据 <code>CMP</code> 的结果决定跳转到哪里去的 **，然后相应修改两个元件即可</p><p><strong>我强烈建议大家课下搭建 <code>CPU</code> 时把是否跳转的 <code>b_jump</code> 信号跟着流水线一直传递到最后</strong>，因为条件链接需要根据 <code>b_jump</code> 信号来决定本条指令是写 <code>5'd31</code> 还是 <code>5'd0</code> 寄存器，在把 <code>b_jump</code> 连到 <code>control</code> 里面后只需要这样即可</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 要向寄存器中写入的值</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">assign</span> GRFWDSel <span class="token operator">=</span> <span class="token punctuation">(</span>jump_link <span class="token operator">|</span> branch_link<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`WDSel_pc8</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                  <span class="token punctuation">(</span>load<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`WDSel_dmrd</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                  <span class="token punctuation">(</span>mf<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`WDSel_mduans</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                  <span class="token constant">`WDSel_aluans</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 要写入哪个寄存器</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">assign</span> GRFA3 <span class="token operator">=</span> <span class="token punctuation">(</span>calc_r <span class="token operator">|</span> jalr <span class="token operator">|</span> mf<span class="token punctuation">)</span> <span class="token operator">?</span> rd <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>               <span class="token punctuation">(</span>calc_i <span class="token operator">|</span> load<span class="token punctuation">)</span> <span class="token operator">?</span> rt <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    		   <span class="token punctuation">(</span>jal <span class="token operator">|</span> <span class="token punctuation">(</span>branch_link <span class="token operator">&amp;&amp;</span> b_jump<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">5'd31</span> <span class="token punctuation">:</span>		<span class="token comment">// 仅限条件链接</span></pre></td></tr><tr><td data-num="11"></td><td><pre>               <span class="token number">5'd0</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>对于清空延迟槽，P5 已经说过了，<strong>要注意在处于阻塞状态时不能立即清空延迟槽指令，因为这时候你得到的 <code>b_jump</code> 未必是正确的</strong>，代码如下：</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// D_CMP.v</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">assign</span> flush <span class="token operator">=</span> <span class="token punctuation">(</span>CMPOp <span class="token operator">==</span> <span class="token constant">`CMP_bltzall</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>jump<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// mips.v</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">assign</span> FD_REG_Flush <span class="token operator">=</span> CMP_flush <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Stall<span class="token punctuation">;</span></pre></td></tr></table></figure><p>对于本题而言，跳转方式反而与 <code>jr, jalr</code> 类似，但是还是需要 <code>CMP</code> 的判断，因此<strong>考虑给 <code>NPC</code> 和 <code>CMP</code> 都添加新的控制信号，然后 <code>CMP</code> 按 <code>rtData &lt; 0</code> 比较，NPC 按 <code>jr</code> 跳转</strong>，就可以轻松解决本题</p><h4 id="类似的往年题"><a class="anchor" href="#类似的往年题">#</a> 类似的往年题</h4><h5 id="blezalc"><a class="anchor" href="#blezalc">#</a> blezalc</h5><p>小于等于 0 时跳转并链接，显然也是跳转并链接并且不清空延迟槽，按照上述套路<strong>只需要改 CMP 即可</strong>，因为这条指令的跳转方式跟其他的 b 型指令一致</p><h3 id="第三类条件储存"><a class="anchor" href="#第三类条件储存">#</a> 第三类：条件储存</h3><p>属于是大 Boss 了，不论是什么样的条件储存题目，都有这样的<strong>特点：我们至少在 M 级之前都无法确切得知我们要写的寄存器和要写的值是什么</strong>，这就是条件储存的 “条件”</p><p>对于这类题目，我们认为最保险的情况就是<strong>当啥都知道的时候（即 W 级时），在一起处理所有的问题，即要写啥要写什么这两个问题</strong></p><p>但是问题在于，在 W 级之前怎么办？</p><p><strong>当我们不确定自己要写啥寄存器时，把当前要写的寄存器设置为 0 总是最保险的</strong>，这是因为我们不会处理向 0 号寄存器里面写的转发</p><p>至于要写啥有需要分成两种情况：一是一开始就知道要写的是 DM 的数据，二是那种如果满足某种情况就写 DM 数据，否则我们写其他数据（寄存器啊，PC+8 啊，PC+4 啊各种乱七八糟的...），但是由于我们是在 W 级才处理这些问题，所以无论写的是啥乱七八糟的东西，我们可以<strong>确定拿到的一定是正确的数据</strong>，结论是<strong>在 W 级之前，我们设置的写入寄存器的数据是啥都无所谓！</strong></p><p>为什么呢？这就是下面要说的阻塞，我们对于条件储存的指令，阻塞的策略是：如果后面有这条指令，前面的寄存器需要读<strong>后面这条指令可能需要写</strong>的寄存器，在这里 <code>lhogez</code> 就是指 rt 和 31 号寄存器，再例如说下面的 <code>lwmx</code> 指令就是 4 号和 5 号寄存器，<strong>总之只要条件储存指令在流水线 W 级之前，并且后面的那条指令要读后面这条指令可能需要写的寄存器，就必须把它阻塞在 D 级</strong>，这样的话条件储存指令在 W 级之前<strong>根本不会向前转发</strong>，因此根本不需要特别关心设置的写入寄存器的数据是啥，阻塞时这样设置即可</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">wire</span> E_stall_rs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>E_lwmx <span class="token operator">?</span> <span class="token punctuation">(</span>D_rs_addr <span class="token operator">==</span> <span class="token number">5'd4</span> <span class="token operator">||</span> D_rs_addr <span class="token operator">==</span> <span class="token number">5'd5</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>E_GRFA3 <span class="token operator">==</span> D_rs_addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> D_rs_addr <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>E_Tnew <span class="token operator">></span> D_Tuse_rs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">wire</span> E_stall_rt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>E_lwmx <span class="token operator">?</span> <span class="token punctuation">(</span>D_rt_addr <span class="token operator">==</span> <span class="token number">5'd4</span> <span class="token operator">||</span> D_rt_addr <span class="token operator">==</span> <span class="token number">5'd5</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>E_GRFA3 <span class="token operator">==</span> D_rt_addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> D_rt_addr <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>E_Tnew <span class="token operator">></span> D_Tuse_rt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">wire</span> M_stall_rs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>M_lwmx <span class="token operator">?</span> <span class="token punctuation">(</span>D_rs_addr <span class="token operator">==</span> <span class="token number">5'd4</span> <span class="token operator">||</span> D_rs_addr <span class="token operator">==</span> <span class="token number">5'd5</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>M_GRFA3 <span class="token operator">==</span> D_rs_addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> D_rs_addr <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>M_Tnew <span class="token operator">></span> D_Tuse_rs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">wire</span> M_stall_rt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>M_lwmx <span class="token operator">?</span> <span class="token punctuation">(</span>D_rt_addr <span class="token operator">==</span> <span class="token number">5'd4</span> <span class="token operator">||</span> D_rt_addr <span class="token operator">==</span> <span class="token number">5'd5</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>M_GRFA3 <span class="token operator">==</span> D_rt_addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> D_rt_addr <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>M_Tnew <span class="token operator">></span> D_Tuse_rt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">assign</span> Stall <span class="token operator">=</span> E_stall_rs <span class="token operator">|</span> E_stall_rt <span class="token operator">|</span> M_stall_rs <span class="token operator">|</span> M_stall_rt<span class="token punctuation">;</span></pre></td></tr></table></figure><p>然后是条件如何判断？我们选择在 W 级判断，直接把判断逻辑写在 <code>mips.v</code> 或者 <code>datapath</code> 里面，生成一个 <code>check</code> 信号，然后连入 W 级的 <code>control</code> 里面去判断写什么，写哪里</p><p>但是这个时候前面 DEM 级的 <code>control</code> 会出现 <code>check</code> 信号是浮空值 <code>z</code> 的情况，这时候我们需要特殊用 <code>===</code> 语法进行判断，即得到浮空值，并且当前指令是条件储存，那么这时把要写的寄存器地址赋值成 <code>5'd0</code> ，以 <code>lhonez</code> 指令和 <code>lwer</code> 指令为例，示例代码如下：</p><figure class="highlight verilog"><figcaption data-lang="verilog"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// mips.v</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">reg</span> W_lhonez_check<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> W_lwer_dst<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	W_lwer_dst <span class="token operator">=</span> <span class="token punctuation">(</span>W_rt_data <span class="token operator">+</span> W_DMRD<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">32'h1e</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	count1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">if</span><span class="token punctuation">(</span>W_DMRD<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1'b1</span><span class="token punctuation">)</span> count1 <span class="token operator">=</span> count1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	W_lhonez_check <span class="token operator">=</span> <span class="token punctuation">(</span>count1 <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1'b1</span> <span class="token punctuation">:</span> <span class="token number">1'b0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>control <span class="token function">W_CTRL</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">Instr</span><span class="token punctuation">(</span>W_Instr<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">b_jump</span><span class="token punctuation">(</span>W_b_jump<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">lhonez_check</span><span class="token punctuation">(</span>W_lhonez_check<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">lwer_dst</span><span class="token punctuation">(</span>W_lwer_dst<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        </pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">GRFA3</span><span class="token punctuation">(</span>W_GRFA3<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">GRFWDSel</span><span class="token punctuation">(</span>W_GRFWDSel<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">GRFWrEn</span><span class="token punctuation">(</span>W_GRFWrEn<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">// control.v</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">assign</span> GRFWDSel <span class="token operator">=</span> <span class="token punctuation">(</span>jump_link <span class="token operator">|</span> branch_link<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`WDSel_pc8</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                  <span class="token punctuation">(</span><span class="token punctuation">(</span>load <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>lhonez<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>lhonez <span class="token operator">&amp;&amp;</span> lhonez_check <span class="token operator">===</span> <span class="token number">1'b1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`WDSel_dmrd</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                  <span class="token punctuation">(</span>lhonez <span class="token operator">&amp;&amp;</span> lhonez_check <span class="token operator">===</span> <span class="token number">1'b0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`WDSel_pc4</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                  <span class="token punctuation">(</span>mf<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`WDSel_mduans</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                  <span class="token punctuation">(</span>jap<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">`WDSel_jap</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                  <span class="token constant">`WDSel_aluans</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">assign</span> GRFA3 <span class="token operator">=</span> <span class="token punctuation">(</span>lhonez <span class="token operator">&amp;&amp;</span> lhonez_check <span class="token operator">===</span> <span class="token number">1'bz</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">5'b0</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>               <span class="token punctuation">(</span>lwer <span class="token operator">&amp;&amp;</span> lwer_dst <span class="token operator">===</span> <span class="token number">32'bz</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">5'b0</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>               <span class="token punctuation">(</span>lwer <span class="token operator">&amp;&amp;</span> lwer_dst <span class="token operator">!==</span> <span class="token number">32'bz</span><span class="token punctuation">)</span> <span class="token operator">?</span> lwer_dst<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>               <span class="token punctuation">(</span>calc_r <span class="token operator">|</span> jalr <span class="token operator">|</span> mf<span class="token punctuation">)</span> <span class="token operator">?</span> rd <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>               <span class="token punctuation">(</span>calc_i <span class="token operator">|</span> <span class="token punctuation">(</span>load <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>lwer <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>lhonez<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>lhonez <span class="token operator">&amp;&amp;</span> lhonez_check <span class="token operator">===</span> <span class="token number">1'b1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> rt <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>               <span class="token punctuation">(</span>jal <span class="token operator">|</span> branch_link <span class="token operator">|</span> <span class="token punctuation">(</span>lhonez <span class="token operator">&amp;&amp;</span> lhonez_check <span class="token operator">===</span> <span class="token number">1'b0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">5'd31</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>               <span class="token punctuation">(</span>jap<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">5'd29</span> <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>               <span class="token number">5'd0</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>lwer</code> 指令还稍微有些不同，我们在 W 级确定的是写入的地址，因此我们传入的不再是 <code>check</code> 信号，而是寄存器地址</p><p>里面还有一些别的其它指令，后面会再说，先说一下 <code>lwer</code> 和 <code>lhonez</code> 以及本次课上考试指令的具体描述</p><h4 id="lwer"><a class="anchor" href="#lwer">#</a> lwer</h4><p><strong>文字描述</strong></p><p>从内存读出数 ( <code>memword</code> )，经表达式</p><pre><code>(memword + GRF[rt]) &amp; 0x1e
</code></pre><p>算出<strong>要写的</strong>寄存器编号（必为偶数），再将 <code>memword</code> 写入该寄存器</p><p><strong>解法</strong></p><p>这是 P6 第一次课上考试的题目</p><p>关键代码已经如上，具体思路就是<strong>在 W 级判断，其余数据相关指令阻塞到 D 级</strong>，<strong>注意这里的数据相关型指令是指要读的寄存器地址为偶数的指令</strong></p><h4 id="lhonez"><a class="anchor" href="#lhonez">#</a> lhonez</h4><p><strong>文字描述</strong></p><p>从内存读出<strong>半字</strong>数据，比较该数据中数字 1 和 0 的个数的多少，1 多的情况下将该数据写入 rt 寄存器，否则将 PC+4 写入 31 号寄存器</p><p><strong>解法</strong></p><p>思路还是上面那样，总之在 W 级再判断，然后其他的数据相关指令阻塞到 D 级不会出问题，大致框架定下来之后，其他的就是细化如何判断，阻塞逻辑是什么（就是什么是数据相关的指令），然后把 <code>check</code> 信号连到 <code>control</code> 里面，注意一下特判浮空值，然后就不会有问题了</p><h4 id="lwmx"><a class="anchor" href="#lwmx">#</a> lwmx</h4><p><strong>指令描述</strong></p><table><thead><tr><th>opcode</th><th>base</th><th>rt</th><th>offset</th></tr></thead><tbody><tr><td>101010</td><td><code>base</code> 寄存器地址</td><td><code>rt</code> 寄存器地址</td><td>16 位偏移量</td></tr></tbody></table><p><strong>指令行为</strong></p><p>如果从内存中读出的 <code>memword</code> 值大于 <code>GPR[rt]</code> 则将 <code>memword</code> 写入 5 号寄存器中，否则写入 4 号寄存器中</p><p><strong>解法</strong></p><ul><li>就不放代码了，详细说一说思路</li><li>首先明确<strong>数据相关的指令就是指需要读 4 号 5 号寄存器的指令，这些指令需要在 <code>stall.v</code> 中添加逻辑让其阻塞在 D 级</strong></li><li>然后把判断放在 W 级，这时候我们需要把 <code>rt_data</code> 数据跟着流水线传递到 W 级（这时候的 <code>rt_data</code> 一定是正确的，想一想为什么？）</li><li>判断就是比大小，<strong>注意是有符号比较</strong>，然后生成 <code>check</code> 信号传入 W 级 <code>control</code> ，<strong>小心 DEM 级 <code>control</code> 的浮空值</strong></li><li>在 <code>control</code> 里面添加逻辑根据 <code>check</code> 信号是 <code>1'b0, 1'b1, 1'bz</code> 设置正确的待写入寄存器地址</li><li>待写入寄存器的值从一开始就很明确，是读出的 <code>memword</code> ，所以没啥好说的</li></ul><h4 id="往届考试的相似题型"><a class="anchor" href="#往届考试的相似题型">#</a> 往届考试的相似题型</h4><h5 id="lwld"><a class="anchor" href="#lwld">#</a> lwld</h5><p>读出来的 <code>memword</code> 如果满足 <code>memword[1:0]==0 &amp;&amp; memword &gt;= 32'h3000</code> 就写到 31 号寄存器，否则写到 rt 寄存器</p><p>典型的条件写，待写入的值很明确，就是 <code>memword</code> ，只需要在 W 级完成判断逻辑，在 <code>stall.v</code> 中完成阻塞逻辑即可</p><h3 id="第四类一些奇奇怪怪不能归入某一类的题目"><a class="anchor" href="#第四类一些奇奇怪怪不能归入某一类的题目">#</a> 第四类：一些奇奇怪怪不能归入某一类的题目</h3><h4 id="movz"><a class="anchor" href="#movz">#</a> movz</h4><p><strong>文字描述</strong></p><p>当 <code>GRF[rt] &gt; 0</code> 时，将 <code>GRF[rs]</code> 写入 <code>GRF[rd]</code> ，否则不写</p><p><strong>解法</strong></p><ul><li>好像是一条 R 型计算类指令，但是如果 <code>GRF[rt] &lt;= 0</code> 时又不去写计算结果了</li><li>根据 Harahan 大佬的意见，本题可以看成计算类指令，但是需要在 <code>ALU</code> 中重新加入 <code>ALU_check</code> 判断 <code>GRF[rt] &gt; 0</code> ，然后信号沿着流水线传递，去确定写不写寄存器</li></ul><h4 id="jap"><a class="anchor" href="#jap">#</a> jap</h4><p><strong>文字描述</strong></p><ul><li>从编号为<strong> 29 号</strong>的寄存器读出数据，作为地址将<strong> PC+8</strong> 写入<strong>内存</strong></li><li>维护这个以 29 号寄存器的值为栈顶指针的栈（这个栈和内存里的栈一样是<strong>倒着</strong>长得），即让 29 号寄存器的值<strong>减 4</strong> 再写入 29 号<strong>寄存器</strong></li><li>完成与<strong> j 指令</strong>一摸一样的跳转操作</li></ul><p><strong>RTL 语言描述</strong></p><pre><code>Addr &lt;- GRF[29]
mem[addr] &lt;- PC + 8
GRF[29] &lt;- GRF[29] - 4
PC &lt;- PC[31:28]||imm26||00
</code></pre><p><strong>解法</strong></p><p>这一题的操作非常多，贯穿了整个数据通路，所以我们应当找到一条<strong>关键路径</strong>，这条路径最长而且时这条指令的中心任务</p><p>我认为关键路径应当是 <code>GRF[29] &lt;- GRF[29] - 4</code> ，其他的什么跳转和写内存都只是路径上顺便完成的任务而已</p><ul><li><p>首先到了 D 级，我们应当顺便利用 <code>NPC</code> 完成跳转操作，因为是无条件跳转，因此这个任务是没有难度的，直接改 <code>NPCOp</code> 即可</p></li><li><p>然后到了 E 级，我们利用 <code>ALU</code> 完成 <code>GRF[29] + 0</code> 操作，得到的 <code>ALUAns</code> 是要写入的地址，而要写入寄存器的值敲好就是 <code>ALUAns - 4</code> ，这一点特判即可，关于阻塞，这里我们在 E 级就需要用到 <code>GRF[29]</code> 的值，即<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo stretchy="false">{</mo><mi>j</mi><mi>a</mi><mi>p</mi><mo stretchy="false">}</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">T_{use}\{jap\}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mclose">}</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span></p></li><li><p>然后到了 M 级，我们写入 DM 只需要改变 <code>DMWrEn</code> ，然后把 PC+8 作为写入数据即可，这时也应当特判</p></li><li><p>然后在 W 级，正常写入</p></li></ul><p><strong>需要注意的是：我们从 E 级开始就需要处理由于 <code>jap</code> 指令导致的 29 号寄存器数据的转发了</strong></p><p><strong>在上面的过程中，我们多次用到了特判，因此把 <code>jap</code> 归入哪一类指令都是不合适的，因此我们考虑单开一类，特殊处理</strong></p><div class="tags"><a href="/tags/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" rel="tag"><i class="ic i-tag"></i> 北航计算机组成原理</a> <a href="/tags/Verilog/" rel="tag"><i class="ic i-tag"></i> Verilog</a> <a href="/tags/MIPS/" rel="tag"><i class="ic i-tag"></i> MIPS</a> <a href="/tags/%E6%B5%81%E6%B0%B4%E7%BA%BFCPU/" rel="tag"><i class="ic i-tag"></i> 流水线CPU</a> <a href="/tags/P6%E8%AF%BE%E4%B8%8A/" rel="tag"><i class="ic i-tag"></i> P6课上</a> <a href="/tags/P6%E8%AF%BE%E4%B8%8B/" rel="tag"><i class="ic i-tag"></i> P6课下</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-12-15 23:15:45" itemprop="dateModified" datetime="2021-12-15T23:15:45+08:00">2021-12-15</time> </span><span id="2021/12/08/BUAA-CO-2021/P6/P6课上&课下/" class="item leancloud_visitors" data-flag-title="P6 课下 & 课上总结" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="FL 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="FL 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="FL 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>FL <i class="ic i-at"><em>@</em></i>FlyingLandlord's Blog</li><li class="link"><strong>本文链接：</strong> <a href="http://flyinglandlord.github.io/2021/12/08/BUAA-CO-2021/P6/P6%E8%AF%BE%E4%B8%8A&%E8%AF%BE%E4%B8%8B/" title="P6 课下 &amp; 课上总结">http://flyinglandlord.github.io/2021/12/08/BUAA-CO-2021/P6/P6课上&课下/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/12/02/BUAA-CO-2021/P5/P5%E8%AF%BE%E4%B8%8A1&2/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?type&#x3D;wallpaper&amp;size&#x3D;1920x1080?872476" title="P5课上测试1&amp;2"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 北航计算机组成原理</span><h3>P5课上测试1&2</h3></a></div><div class="item right"><a href="/2021/12/15/BUAA-CO-2021/P7/P7%E8%AF%BE%E4%B8%8A&%E8%AF%BE%E4%B8%8B/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;api.yimian.xyz&#x2F;img?type&#x3D;wallpaper&amp;size&#x3D;1920x1080?604942" title="P7课下&amp;课上总结"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 北航计算机组成原理</span><h3>P7课下&课上总结</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#p6%E8%BE%83%E5%AE%8C%E5%96%84%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BFcpu%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.</span> <span class="toc-text">P6：较完善的流水线 CPU 设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E4%B8%8B%E9%83%A8%E5%88%86"><span class="toc-number">1.1.</span> <span class="toc-text">课下部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E4%B8%8A%E9%83%A8%E5%88%86"><span class="toc-number">1.2.</span> <span class="toc-text">课上部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%B1%BB%E8%BF%90%E7%AE%97%E7%B1%BB"><span class="toc-number">1.2.1.</span> <span class="toc-text">第一类：运算类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#shl-swap-hi-lo"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">shl (swap HI LO)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bds-big-divideunsigned-small"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">bds (big divide(unsigned) small)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%B1%BB%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC"><span class="toc-number">1.2.2.</span> <span class="toc-text">第二类：条件跳转</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bezal"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">bezal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E4%BC%BC%E7%9A%84%E5%BE%80%E5%B9%B4%E9%A2%98"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">类似的往年题</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#blezalc"><span class="toc-number">1.2.2.2.1.</span> <span class="toc-text">blezalc</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%B1%BB%E6%9D%A1%E4%BB%B6%E5%82%A8%E5%AD%98"><span class="toc-number">1.2.3.</span> <span class="toc-text">第三类：条件储存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lwer"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">lwer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lhonez"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">lhonez</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lwmx"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">lwmx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%80%E5%B1%8A%E8%80%83%E8%AF%95%E7%9A%84%E7%9B%B8%E4%BC%BC%E9%A2%98%E5%9E%8B"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">往届考试的相似题型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#lwld"><span class="toc-number">1.2.3.4.1.</span> <span class="toc-text">lwld</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%B1%BB%E4%B8%80%E4%BA%9B%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E4%B8%8D%E8%83%BD%E5%BD%92%E5%85%A5%E6%9F%90%E4%B8%80%E7%B1%BB%E7%9A%84%E9%A2%98%E7%9B%AE"><span class="toc-number">1.2.4.</span> <span class="toc-text">第四类：一些奇奇怪怪不能归入某一类的题目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#movz"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">movz</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jap"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">jap</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/09/15/BUAA-CO-2021/Pre/Logisim%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" rel="bookmark" title="Logisim斐波那契电路">Logisim斐波那契电路</a></li><li><a href="/2021/09/25/BUAA-CO-2021/Pre/%E5%85%B3%E4%BA%8ECPU%E8%BE%93%E5%87%BA%E5%BA%8F%E5%88%97%E6%A3%80%E6%9F%A5%E9%A2%98%E7%9A%84%E8%B0%83%E8%AF%95%E5%BB%BA%E8%AE%AE/" rel="bookmark" title="CPU输出序列检查调试方法">CPU输出序列检查调试方法</a></li><li><a href="/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part1)/" rel="bookmark" title="Verilog 学习笔记（1）">Verilog 学习笔记（1）</a></li><li><a href="/2021/09/25/BUAA-CO-2021/Pre/Verilog%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0%E9%A2%98%E6%80%BB%E7%BB%93(Part2)/" rel="bookmark" title="Verilog 学习笔记（2）">Verilog 学习笔记（2）</a></li><li><a href="/2021/09/30/BUAA-CO-2021/Pre/%E8%B0%88%E4%B8%80%E8%B0%88MIPS%E6%B1%87%E7%BC%96Challenge%E9%A2%98/" rel="bookmark" title="MIPS汇编哈密顿回路">MIPS汇编哈密顿回路</a></li><li><a href="/2021/10/13/BUAA-CO-2021/Pre/Logisim%E5%A4%8D%E4%B9%A0/" rel="bookmark" title="Logisim Pre考前复习">Logisim Pre考前复习</a></li><li><a href="/2021/10/13/BUAA-CO-2021/Pre/Verilog%E5%A4%8D%E4%B9%A0/" rel="bookmark" title="Verilog Pre考前复习">Verilog Pre考前复习</a></li><li><a href="/2021/10/13/BUAA-CO-2021/Pre/Pre%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95/" rel="bookmark" title="Pre课上测试游记">Pre课上测试游记</a></li><li><a href="/2021/10/20/BUAA-CO-2021/P0/P0%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" rel="bookmark" title="P0课上测试游记">P0课上测试游记</a></li><li><a href="/2021/10/24/BUAA-CO-2021/P1/P1%E8%AF%BE%E4%B8%8B%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="P1课下学习">P1课下学习</a></li><li><a href="/2021/10/27/BUAA-CO-2021/P1/P1%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" rel="bookmark" title="P1课上测试游记">P1课上测试游记</a></li><li><a href="/2021/11/01/BUAA-CO-2021/P2/P2%E8%AF%BE%E4%B8%8B%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="P2课下学习">P2课下学习</a></li><li><a href="/2021/11/03/BUAA-CO-2021/P2/P2%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" rel="bookmark" title="P2课上测试游记">P2课上测试游记</a></li><li><a href="/2021/11/10/BUAA-CO-2021/P3/P3%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" rel="bookmark" title="P3课上测试游记">P3课上测试游记</a></li><li><a href="/2021/11/13/BUAA-CO-2021/P3/CPU%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/" rel="bookmark" title="P3课下学习—单周期CPU设计(1)">P3课下学习—单周期CPU设计(1)</a></li><li><a href="/2021/11/13/BUAA-CO-2021/P4/CPU%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/" rel="bookmark" title="P4课下学习—单周期CPU设计(2)">P4课下学习—单周期CPU设计(2)</a></li><li><a href="/2021/11/17/BUAA-CO-2021/P4/P4%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" rel="bookmark" title="P4课上测试">P4课上测试</a></li><li><a href="/2021/12/01/BUAA-CO-2021/P5/P5%E8%AF%BE%E4%B8%8B/" rel="bookmark" title="P5课下学习—流水线CPU设计(1)">P5课下学习—流水线CPU设计(1)</a></li><li><a href="/2021/12/02/BUAA-CO-2021/P5/P5%E8%AF%BE%E4%B8%8A1&2/" rel="bookmark" title="P5课上测试1&2">P5课上测试1&2</a></li><li class="active"><a href="/2021/12/08/BUAA-CO-2021/P6/P6%E8%AF%BE%E4%B8%8A&%E8%AF%BE%E4%B8%8B/" rel="bookmark" title="P6课下&课上总结">P6课下&课上总结</a></li><li><a href="/2021/12/15/BUAA-CO-2021/P7/P7%E8%AF%BE%E4%B8%8A&%E8%AF%BE%E4%B8%8B/" rel="bookmark" title="P7课下&课上总结">P7课下&课上总结</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="FL" data-src="/images/avatar.jpg"><p class="name" itemprop="name">FL</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">22</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">4</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">26</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZseWluZ2xhbmRsb3Jk" title="https:&#x2F;&#x2F;github.com&#x2F;flyinglandlord"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjI2NDUzNzcxNjFAcXEuY29t" title="mailto:2645377161@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/12/02/BUAA-CO-2021/P5/P5%E8%AF%BE%E4%B8%8A1&2/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/12/15/BUAA-CO-2021/P7/P7%E8%AF%BE%E4%B8%8A&%E8%AF%BE%E4%B8%8B/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/11/13/BUAA-CO-2021/P4/CPU%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/" title="P4课下学习—单周期CPU设计(2)">P4课下学习—单周期CPU设计(2)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/10/24/BUAA-CO-2021/P1/P1%E8%AF%BE%E4%B8%8B%E5%AD%A6%E4%B9%A0/" title="P1课下学习">P1课下学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/11/03/BUAA-CO-2021/P2/P2%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" title="P2课上测试游记">P2课上测试游记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/09/15/BUAA-CO-2021/Pre/Logisim%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/" title="Logisim斐波那契电路">Logisim斐波那契电路</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/10/13/BUAA-CO-2021/Pre/Verilog%E5%A4%8D%E4%B9%A0/" title="Verilog Pre考前复习">Verilog Pre考前复习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/09/30/BUAA-CO-2021/Pre/%E8%B0%88%E4%B8%80%E8%B0%88MIPS%E6%B1%87%E7%BC%96Challenge%E9%A2%98/" title="MIPS汇编哈密顿回路">MIPS汇编哈密顿回路</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/09/25/BUAA-CO-2021/Pre/%E5%85%B3%E4%BA%8ECPU%E8%BE%93%E5%87%BA%E5%BA%8F%E5%88%97%E6%A3%80%E6%9F%A5%E9%A2%98%E7%9A%84%E8%B0%83%E8%AF%95%E5%BB%BA%E8%AE%AE/" title="CPU输出序列检查调试方法">CPU输出序列检查调试方法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/11/13/BUAA-CO-2021/P3/CPU%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/" title="P3课下学习—单周期CPU设计(1)">P3课下学习—单周期CPU设计(1)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/11/17/BUAA-CO-2021/P4/P4%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%B8%B8%E8%AE%B0/" title="P4课上测试">P4课上测试</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8C%97%E8%88%AA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 北航计算机组成原理">北航计算机组成原理</a></div><span><a href="/2021/12/08/BUAA-CO-2021/P6/P6%E8%AF%BE%E4%B8%8A&%E8%AF%BE%E4%B8%8B/" title="P6课下&amp;课上总结">P6课下&课上总结</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">FL @ Test Blog</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/12/08/BUAA-CO-2021/P6/P6课上&课下/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>